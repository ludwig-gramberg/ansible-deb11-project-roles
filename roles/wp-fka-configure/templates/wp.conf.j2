<Directory {{ wp_docroot }}>
	Options -Indexes +FollowSymLinks
	AllowOverride None

	RewriteEngine on
	RewriteBase /

	RewriteBase /
	RewriteCond %{REQUEST_URI} !^/wp\-json/wp/v2/
	RewriteRule ^wp\-json(/.*)?$ - [L,F]
	RewriteRule ^calendars/([a-f0-9]+)$ /teachem-calendars.php?id=$1 [L]
	RewriteRule ^calendars-api((/[a-z0-9\_]+)+)$ /teachem-calendars-api.php?path=$1 [L]
	RewriteRule ^index\.php$ - [L]
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteRule . /index.php [L]
	
	<FilesMatch "wp-login.php">
		require ip {{ hostvars['server-vpn'].ip_public }}
	</FilesMatch>
</Directory>

<Directory {{ wp_docroot }}/wp-admin>
	require ip {{ hostvars['server-vpn'].ip_public }}
</Directory>

<Directory {{ wp_docroot }}>
	<Files ~ "^(wp\-settings|wp\-activate|wp\-blog\-header|wp\-config|wp\-config\-sample|wp\-cron|wp\-load|wp\-mail|wp\-signup|xmlrpc)\.php$">
	   require all denied
	</Files>
	require all granted
	<FilesMatch "\.(css|txt|ico|xml|js|png|gif|jpeg|jpg|woff|woff2|eot|svg|ttf|otf|htm|html|swf)$">
		Header set Cache-Control "max-age=2592000, public"
	</FilesMatch>
</Directory>

<Directory {{ wp_docroot }}/wp-content>
	php_admin_flag engine off
	require all denied
	<FilesMatch "\.(css|txt|ico|xml|js|png|gif|jpeg|jpg|woff|woff2|eot|svg|ttf|otf|htm|html|swf)$">
		require all granted
	</FilesMatch>
</Directory>

<Directory {{ wp_docroot }}/composer>
	require all denied
</Directory>

<Directory {{ wp_docroot }}/wp-content/themes/feldenkrais>
	require all denied
</Directory>

<Directory {{ wp_docroot }}/wp-content/themes/feldenkrais/css>
	require all denied
	<FilesMatch "\.(css|txt|ico|xml|js|png|gif|jpeg|jpg|woff|woff2|eot|svg|ttf|otf|htm|html|swf)$">
		require all granted
	</FilesMatch>
</Directory>

<Directory {{ wp_docroot }}/wp-content/themes/feldenkrais/images>
	require all denied
	<FilesMatch "\.(css|txt|ico|xml|js|png|gif|jpeg|jpg|woff|woff2|eot|svg|ttf|otf|htm|html|swf)$">
		require all granted
	</FilesMatch>
</Directory>

<Directory {{ wp_docroot }}/wp-content/themes/feldenkrais/js>
	require all denied
	<FilesMatch "\.(css|txt|ico|xml|js|png|gif|jpeg|jpg|woff|woff2|eot|svg|ttf|otf|htm|html|swf)$">
		require all granted
	</FilesMatch>
</Directory>

<Directory {{ wp_docroot }}/wp-content/themes/feldenkrais/fonts>
	require all denied
	<FilesMatch "\.(css|txt|ico|xml|js|png|gif|jpeg|jpg|woff|woff2|eot|svg|ttf|otf|htm|html|swf)$">
		require all granted
	</FilesMatch>
</Directory>

<Directory {{ wp_docroot }}/wp-content/plugins>
	php_admin_flag engine on
	AllowOverride All
</Directory>

<Directory {{ wp_docroot }}/wp-includes>
	php_admin_flag engine off
	require all denied
	<FilesMatch "\.(css|txt|ico|xml|js|png|gif|jpeg|jpg|woff|woff2|eot|svg|ttf|otf|htm|html|swf)$">
		require all granted
	</FilesMatch>
</Directory>

<Directory {{ wp_docroot }}/wp-content/uploads>
	php_admin_flag engine off
	require all denied
	<FilesMatch "\.(css|txt|ico|xml|js|png|gif|jpeg|jpg|woff|woff2|eot|svg|ttf|otf|htm|html|pdf|doc|docx|xls|xlsx|tiff|zip|gz|tar|bz|bz2|mp3|mp4)$">
		require all granted
	</FilesMatch>
</Directory>

<Directory {{ wp_docroot }}/wp-admin/includes>
	require all denied
</Directory>
---

- name: install packages
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - "imagemagick"

- name: teachem calendars redirect
  template: 
    dest: "{{ wp_docroot }}/teachem-calendars.php" 
    src: templates/teachem-calendars.php.j2 
    owner: root
    group: www-data
    mode: 0640

- name: teachem calendars-api redirect
  template: 
    dest: "{{ wp_docroot }}/teachem-calendars-api.php" 
    src: templates/teachem-calendars-api.php.j2 
    owner: root 
    group: www-data
    mode: 0640

- name: deploy wp vhost
  template: 
    dest: /etc/apache2/vhosts-include/wp.conf
    src: templates/wp.conf.j2
  notify:
    - reload apache